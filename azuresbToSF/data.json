{"id":92,"name":"Trigger","displayName":"Azure Service Bus","documentation":"","moduleName":"trigger.asb","serviceTypes":[{"name":"MessageService","description":"Triggers when Choreo recieves a new message from Azure service bus. Available action: onMessage\n","functions":[{"qualifiers":["isolated","remote"],"documentation":"Triggers when a new message is received from Azure service bus\n","name":"onMessage","parameters":[{"name":"message","typeName":"record","optional":false,"typeInfo":{"name":"Message","orgName":"ballerinax","moduleName":"trigger.asb","version":"1.1.2"},"displayAnnotation":{},"documentation":"The Azure service bus message recieved\n","hasRestType":false,"defaultable":false,"fields":[{"members":[{"typeName":"string","optional":false,"defaultable":false},{"typeName":"int","optional":false,"defaultable":false},{"memberType":{"typeName":"byte","optional":false,"defaultable":false},"typeName":"array","optional":false,"defaultable":false}],"name":"body","typeName":"union","optional":false,"defaultable":false},{"name":"contentType","typeName":"string","optional":false,"defaultable":false},{"name":"messageId","typeName":"string","optional":false,"defaultable":false},{"name":"to","typeName":"string","optional":true,"defaultable":false},{"name":"replyTo","typeName":"string","optional":true,"defaultable":false},{"name":"replyToSessionId","typeName":"string","optional":true,"defaultable":false},{"name":"label","typeName":"string","optional":true,"defaultable":false},{"name":"sessionId","typeName":"string","optional":true,"defaultable":false},{"name":"correlationId","typeName":"string","optional":true,"defaultable":false},{"name":"partitionKey","typeName":"string","optional":true,"defaultable":false},{"name":"timeToLive","typeName":"int","optional":true,"defaultable":false},{"name":"sequenceNumber","typeName":"int","optional":true,"defaultable":false},{"name":"lockToken","typeName":"string","optional":false,"defaultable":false},{"fields":[{"paramType":{"typeName":"any","optional":false,"defaultable":false},"name":"properties","typeName":"map","optional":true,"defaultable":false}],"hasRestType":false,"name":"applicationProperties","typeName":"record","optional":true,"typeInfo":{"name":"ApplicationProperties","orgName":"ballerinax","moduleName":"trigger.asb","version":"1.1.2"},"defaultable":false},{"name":"deliveryCount","typeName":"int","optional":true,"defaultable":false},{"name":"enqueuedTime","typeName":"string","optional":true,"defaultable":false},{"name":"enqueuedSequenceNumber","typeName":"int","optional":true,"defaultable":false},{"name":"deadLetterErrorDescription","typeName":"string","optional":true,"defaultable":false},{"name":"deadLetterReason","typeName":"string","optional":true,"defaultable":false},{"name":"deadLetterSource","typeName":"string","optional":true,"defaultable":false},{"name":"state","typeName":"string","optional":true,"defaultable":false}]},{"name":"caller","typeName":"object","optional":false,"typeInfo":{"name":"Caller","orgName":"ballerinax","moduleName":"trigger.asb","version":"1.1.2"},"displayAnnotation":{},"documentation":"The Azure service bus caller instance\n","defaultable":false,"fields":[]}],"returnType":{"typeName":"error","optional":true,"displayAnnotation":{},"documentation":"Error on failure else nil()\n","defaultable":false},"displayAnnotation":{}},{"qualifiers":["isolated","remote"],"documentation":"Triggers when there is an error in message processing\n\n","name":"onError","parameters":[{"name":"context","typeName":"record","optional":false,"typeInfo":{"name":"ErrorContext","orgName":"ballerinax","moduleName":"trigger.asb","version":"1.1.2"},"displayAnnotation":{},"documentation":"Error message details  \n","hasRestType":true,"defaultable":false,"fields":[{"name":"entityPath","typeName":"string","optional":false,"defaultable":false},{"name":"className","typeName":"string","optional":false,"defaultable":false},{"name":"namespace","typeName":"string","optional":false,"defaultable":false},{"name":"errorSource","typeName":"string","optional":false,"defaultable":false},{"name":"reason","typeName":"string","optional":false,"defaultable":false}],"restType":{"typeName":"anydata","optional":false,"defaultable":false}},{"name":"'error","typeName":"error ","optional":false,"displayAnnotation":{},"documentation":"","defaultable":false}],"returnType":{"typeName":"error","optional":true,"displayAnnotation":{},"documentation":"Error on failure else nil()\n","defaultable":false},"displayAnnotation":{}}],"displayAnnotation":{}}],"listenerParams":[{"name":"config","typeName":"record","optional":false,"typeInfo":{"name":"ListenerConfig","orgName":"ballerinax","moduleName":"trigger.asb","version":"1.1.2"},"displayAnnotation":{},"documentation":"","hasRestType":true,"defaultable":false,"fields":[{"name":"connectionString","typeName":"string","optional":false,"defaultable":false}],"restType":{"typeName":"anydata","optional":false,"defaultable":false}}],"listenerProtocol":"generic","displayAnnotation":{"label":"Azure Service Bus","iconPath":"docs/icon.png"},"package":{"organization":"ballerinax","name":"trigger.asb","version":"1.1.2","platform":"java11","languageSpecificationVersion":"2022R4","isDeprecated":false,"deprecateMessage":"","URL":"/ballerinax/trigger.asb/1.1.2","balaVersion":"2.0.0","balaURL":"https://fileserver.central.ballerina.io/2.0/ballerinax/trigger.asb/1.1.2/ballerinax-trigger.asb-java11-1.1.2.bala?md5=iBg5IL2w44nWNqBkg3ywwA&expires=1694075670","digest":"sha-256=8ed50625b1773c910feb47153d8b6371819b13fad03799739a34222319d56851","summary":"Listen to [Microsoft Azure Messaging Service Bus](https://learn.microsoft.com/en-us/java/api/com.azure.messaging.servicebus?view=azure-java-stable) from Ballerina.","readme":"Listen to [Microsoft Azure Messaging Service Bus](https://learn.microsoft.com/en-us/java/api/com.azure.messaging.servicebus?view=azure-java-stable) from Ballerina.\n\n## Package overview\n\nThe `ballerinax/trigger.asb` is a [Ballerina](https://ballerina.io/) trigger for Microsoft Azure Service Bus.\nThis package provides the capability to access Microsoft Azure Service Bus messages from Service Bus queues, topics, and subscriptions, etc.\n\n### Compatibility\n\n|                                   | Version                      |\n|---------------------------------- |------------------------------|\n| Ballerina Language                | Ballerina Swan Lake 2202.4.1 |\n| Azure Messaging Service Bus SDK   | 7.13.1                       |\n\n## Report issues\n\nTo report bugs, request new features, start new discussions, view project boards, etc., go to the [Ballerina AsyncAPI Triggers repository](https://github.com/ballerina-platform/asyncapi-triggers)\n\n## Useful links\n\n- Discuss code changes of the Ballerina project in [ballerina-dev@googlegroups.com](mailto:ballerina-dev@googlegroups.com).\n- Chat live with us via our [Discord server](https://discord.gg/ballerinalang).\n- Post all technical questions on Stack Overflow with the [#ballerina](https://stackoverflow.com/questions/tagged/ballerina) tag","template":false,"licenses":["Apache-2.0"],"authors":["Ballerina"],"sourceCodeLocation":"https://github.com/ballerina-platform/asyncapi-triggers","keywords":["IT Operations/Message Brokers","Cost/Paid","Vendor/Microsoft"],"ballerinaVersion":"2201.4.1","icon":"https://bcentral-packageicons.azureedge.net/images/ballerinax_trigger.asb_1.1.2.png","ownerUUID":"b5a9e54d-8ade-47a1-8abc-6bc46e89069d","createdDate":1692255080000,"pullCount":10,"visibility":"public","modules":[{"packageURL":"/ballerinax/trigger.asb/1.1.2","apiDocURL":"https://lib.ballerina.io/ballerinax/trigger.asb/1.1.2","name":"trigger.asb","summary":"The `ballerinax/trigger.asb` module supports asynchronous message listening capabilities from the [Azure Service Bus](https://learn.microsoft.com/en-us/java/api/com.azure.messaging.servicebus?view=azure-java-stable) via the Ballerina language. ","readme":"## Overview\n\nThe `ballerinax/trigger.asb` module supports asynchronous message listening capabilities from the [Azure Service Bus](https://learn.microsoft.com/en-us/java/api/com.azure.messaging.servicebus?view=azure-java-stable) via the Ballerina language. \nThis module supports [Service Bus SDK 7.13.1 version](https://learn.microsoft.com/en-us/java/api/com.azure.messaging.servicebus?view=azure-java-stable). \nThe source code on GitHub is located [here](https://github.com/Azure/azure-sdk-for-java/tree/main/sdk/servicebus/microsoft-azure-servicebus). \nThe primary wire protocol for Service Bus is Advanced Messaging Queueing Protocol (AMQP) 1.0, an open ISO/IEC standard.\n\n## Prerequisites\n\nBefore using this connector in your Ballerina application, complete the following:\n\n* Create an Azure account and a subscription. If you don't have an Azure\n  subscription, [sign up for a free Azure account](https://azure.microsoft.com/free/).\n\n* Create a Service Bus namespace. If you don't\n  have [a service bus namespace](https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-create-namespace-portal)\n  , learn how to create your Service Bus namespace.\n\n* Create a messaging entity, such as a queue, topic or subscription. If you don't have these items, learn how to\n    * [Create a queue in the Azure portal](https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-portal#create-a-queue-in-the-azure-portal)\n    * [Create a topic using the Azure portal](https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-topics-subscriptions-portal#create-a-topic-using-the-azure-portal)\n    * [Create subscriptions to the topic](https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-topics-subscriptions-portal#create-subscriptions-to-the-topic)\n\n* Obtain tokens\n\n  Shared Access Signature (SAS) Authentication Credentials are required to communicate with the Azure Service Bus.\n    * Connection String\n\n  Obtain the authorization credentials:\n    * For Service Bus Queues\n\n        1. [Create a namespace in the Azure portal](https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-portal#create-a-namespace-in-the-azure-portal)\n\n        2. [Get the connection string](https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-portal#get-the-connection-string)\n\n        3. [Create a queue in the Azure portal](https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-portal#create-a-queue-in-the-azure-portal)\n\n    * For Service Bus Topics and Subscriptions\n\n        1. [Create a namespace in the Azure portal](https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-portal#create-a-namespace-in-the-azure-portal)\n\n        2. [Get the connection string](https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-portal#get-the-connection-string)\n\n        3. [Create a topic in the Azure portal](https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-topics-subscriptions-portal#create-a-topic-using-the-azure-portal)\n\n        4. [Create a subscription in the Azure portal](https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-topics-subscriptions-portal#create-subscriptions-to-the-topic)\n\n## Quickstart\n\nTo use the Azure Service Bus listener in your Ballerina application, update the .bal file as follows:\n\n### Enabling Azure SDK Logs\nTo enable Azure logs in a Ballerina module, you need to set the environment variable ASB_CLOUD_LOGS to ACTIVE. You can do this by adding the following line to your shell script or using the export command in your terminal(to deactivate,remove the variable value):\n\n`export ASB_CLOUD_LOGS=ACTIVE`\n\n### Enabling Internal Connector Logs\nTo enable internal connector logs in a Ballerina module, you need to set the log level in the Config.toml file using the  custom configuration record Where <log_level> is the desired log level (e.g. DEBUG, INFO, WARN, (Default)ERROR, FATAL, OFF)\n\n```\n[ballerinax.trigger.asb.options]\nlogLevel=\"OFF\"\n```\n\n### Step 1: Import listener\n\nImport the `ballerinax/trigger.asb` module as shown below.\n```ballerina\nimport ballerinax/trigger.asb;\n```\n\n### Step 2: Create a new listener endpoint\n```ballerina\nasb:ListenerConfig configuration = {\n    connectionString: \"CONNECTION_STRING\"\n};\n\nlistener asb:Listener asbListener = new (configuration);\n```\n\n### Step 3: Define a consumer service \n\n* Now you can define one or more consumer services and attach it to the defined listener endpoint. The messages will then be delivered automatically as they arrive rather than having to be explicitly requested. Multiple consumer services can be bound to one Ballerina Azure Service Bus `asb:Listener`. \n\n* Listener configurations such as queue or topic name to listen to, message receive mode etc. are configured in the `asb:ServiceConfig`  annotation of the service. \n\n  ```ballerina\n  @asb:ServiceConfig {\n        queueName: \"MyQueue\",\n        peekLockModeEnabled: true,\n        topicName: \"myTopic\",\n        subscriptionName: \"abc\",\n        maxConcurrency: 1,\n        prefetchCount: 10,\n        maxAutoLockRenewDuration: 300,\n        logLevel: ERROR\n    }\n    service asb:Service on myTestListener {\n        remote function onMessage(asb:Message message) {\n            //process message\n        }\n    }\n  ```\n\n  1. queueName : Name of the queue service should listen to. Either queueName or topicName should be configured. \n  2. topicName : Name of the topic service should listen to. Either queueName or topicName should be configured.\n  3. peekLockModeEnabled : ASB has two modes of message receive. Setting this to `true` makes the mode to `PEEK_LOCK`. Making it false or not setting it makes the mode to `RECEIVE_AND_DELETE `. You can find more information about receive\n  modes [here](https://docs.microsoft.com/en-us/java/api/com.microsoft.azure.servicebus.receivemode?view=azure-java-stable)\n  4. subscriptionName : Name of the subscription if a topicName is specified. \n  5. maxConcurrency : How many messages are parallelly dispatched to the service (default =1, means sequential). \n  6. prefetchCount: Number of messages pre-fetched by underlying subscriber for efficiency (default - 0, means prefetch off) \n  7. maxAutoLockRenewDuration: Sets the amount of time to continue auto-renewing the lock in `seconds`. Setting Duration to #ZERO disables   auto-renewal. This is not considered when `peekLockModeEnabled` is false. (default 300 seconds)\n  8. logLevel:  desired log level (e.g. DEBUG, INFO, WARN, (Default)ERROR, FATAL, OFF) for underlying SDK\n\n* Implement logic on how to process the message under `onMessage` resource. \n* Implement logic on how to process error when receiving a message under `onError` resource. \n* Following is a complete example on how to listen to messages from an Azure Service Bus queue called `MyQueue` sequentially using Ballerina ASB listener. \n\n   Listen to Messages from the Azure Service Bus\n\n    ```ballerina\n    import ballerina/lang.value; \n    import ballerina/log;\n    import ballerinax/trigger.asb;\n\n    asb:ListenerConfig configuration = {\n        connectionString: \"CONNECTION_STRING\"\n    };\n\n    listener asb:Listener asbListener = new (configuration);\n\n    @asb:ServiceConfig {\n        queueName: \"MyQueue\",\n        peekLockModeEnabled: true,\n        maxConcurrency: 1,\n        prefetchCount: 10,\n        maxAutoLockRenewDuration: 300\n    }\n    service asb:MessageService on asbListener {\n        isolated remote function onMessage(asb:Message message, asb:Caller caller) returns error? {\n            // Write your message processing logic here\n            log:printInfo(\"Message received from queue: \" + message.toBalString());\n            _ = check caller.complete(message);\n        }\n  \n        isolated remote function onError(asb:ErrorContext context, error 'error) returns error? {\n            // Write your error handling logic here\n        }\n    };\n    ```\n\n   **!!! NOTE:**\n   You can complete, abandon, deadLetter, defer, renewLock using the `asb:Caller` instance. If you want to handle to errors that come when processing messages, use `MessageServiceErrorHandling` service type.\n\n  Use `bal run` command to compile and run the Ballerina program."}],"balToolId":"","graalvmCompatible":"Unknown"},"triggerType":"asb","httpBased":false}